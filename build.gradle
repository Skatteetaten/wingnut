import java.text.SimpleDateFormat
import java.util.Date

buildscript {
  repositories {
    maven {
      url "${nexusUrl}/content/groups/public"
    }
  }
  dependencies {
    classpath(
        "ske.aurora.gradle.plugins:aurora-gradle-plugin:1.7.1",
        "ske.aurora.gradle.plugins:aurora-docker-plugin:1.1.4"
    )
  }
}

//TODO move to plugin
def static buildTime() {
  def df = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm'Z'")
  df.setTimeZone(TimeZone.getTimeZone("UTC"))
  return df.format(new Date())
}

def static gitSha() {
  def cmd = "git rev-parse --short HEAD"
  def proc = cmd.execute()
  return proc.text.trim()

}


apply plugin: 'base'
apply plugin: 'ske.plugins.aurora'
apply plugin: 'ske.plugins.aurora-docker'

auroradocker {
  imageName = 'aurora/wingnut'
  workingDir = "src/main/docker"
  buildArgs = [
      alpineVersion:"3.6",
      jolokiaVersion: "1.3.7",
      javaMajorVersion: "8",
      javaMinorVersion: "131",
      javaBuildVersion: "11-r2",
      baseImageVersion: version,
      buildDate: buildTime(),
      gitSha: gitSha()


  ]
}




task wrapper(type: Wrapper) {
  gradleVersion = "3.4"
}
